df_long$regio <- gsub("'","",df_long$regio)
df_long$regio <- gsub("-"," ",df_long$regio)
df_long <- left_join(df_long,colourscheme)
fptp_results <- table(df_long$party) %>% as.data.frame()
colnames(fptp_results) <- c("party","seats")
fptp_results <- left_join(fptp_results,colourscheme)
ggplot(fptp_results) +
ggpol::geom_parliament(aes(seats = seats, fill = party),color="black") +
#highlight the party in control of the House with a black line
scale_fill_manual(values = fptp_results$colour,
labels = fptp_results$party)+
coord_fixed()+
theme_void()
#sort in long format
df_pie <- df_results %>%
pivot_longer(cols = VVD:Modern.Nederland, names_to = "party", values_to = "votes") %>%
select(regio =RegioNaam, code = RegioCode,party, votes) %>%
filter(!is.na(votes)) %>%
group_by(code) %>%
mutate(total = sum(votes))
df_pie$percentage <- (df_pie$votes/df_pie$total)*100
df_pie$percentage <- round(df_pie$percentage,1)
#
df_pie$party <- gsub("Partij.van.de.Arbeid..P.v.d.A..","PvdA",df_pie$party)
df_pie$party <- gsub("Democraten.66..D66.","D66",df_pie$party)
df_pie$party <- gsub("X50PLUS","Partij 50PLUS",df_pie$party)
df_pie$party <- gsub("Forum.voor.Democratie","FvD",df_pie$party)
df_pie$party <- gsub("Forum.voor.Democratie","FvD",df_pie$party)
df_pie$party <- gsub("SP..Socialistische.Partij.","SP",df_pie$party)
df_pie$party <- gsub("PVV..Partij.voor.de.Vrijheid.","PVV",df_pie$party)
df_pie$party <- gsub("Staatkundig.Gereformeerde.Partij..SGP.","SGP",df_pie$party)
df_pie$party <- gsub("Partij.voor.de.Dieren","PvdD",df_pie$party)
df_pie$party <- as.factor(df_pie$party)
df_pie$party <- as.character(df_pie$party)
df_pie$percentage <- as.numeric(df_pie$percentage)
pie_plot_list <- lapply(unique(df_pie$regio), function(i) {
regio_df <- df_pie %>%
filter(regio == i) %>%
dplyr::ungroup() %>%
select(party,percentage) %>%
filter(percentage >0.1) %>%
as.data.frame()
regio_df <- regio_df[order(regio_df$percentage,decreasing = T),]
regio_df <- left_join(regio_df,colourscheme)
ggplot(regio_df) +
geom_bar(aes(x = "", y = percentage, fill = party),
stat = "identity", colour = "black", width =1) +
#geom_text(aes(x = "", y = pct, label = percent(pct)), position = position_stack(vjust = 0.5))+
coord_polar("y", start = 0) +
labs(x = NULL, y = NULL, fill = NULL,
title = paste("Verkiezingsuitslag",i)) +
theme_classic()+
scale_fill_manual(values = regio_df$colour,
limits = regio_df$party)+
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5, color = "black"))
})
#link to spatial
shp_fptp <- left_join(shp_gemeentes, df_long, by = c("Gemeenteco"="code"))
shp_fptp <- shp_fptp %>%
filter(percentage >0.1)
#I need to make the shapefile alphabetical to match with the pie chart list
#This means removing apostrophe's at 's-Gravenhage and 's-Hertogenbosch
shp_fptp$Gemeentena <- gsub("'","",shp_gemeentes$Gemeentena)
#reorder
shp_fptp <- shp_fptp[order(shp_fptp$Gemeentena),]
#reset rownumbers so they line up
rownames(shp_fptp) <- 1:nrow(shp_fptp)
mapview(shp_fptp,
zcol = "party",
col.regions = shp_fptp$colour,
popup = popupGraph(pie_plot_list))
unique(shp_fptp)
library(dplyr)
library(tidyr)
library(sf)
library(ggplot2)
library(ggiraph)
library(widgetframe)
library(knitr)
library(plotly)
library(ggpol)
library(mapview)
library(leafpop)
library(leaflet)
df_results <- read.csv("Uitslag_alle_gemeenten_TK20210317.csv", sep=";")
shp_gemeentes <- st_read("Gemeentegrenzen_2021/Gemeentegrenzen_2021.shp")
shp_gemeentes$Gemeenteco <- gsub("GM","",shp_gemeentes$Gemeenteco)
colourscheme <- read.csv("partycolours.csv")
#sort in long format
df_long <- df_results %>%
pivot_longer(cols = VVD:Modern.Nederland, names_to = "party", values_to = "votes") %>%
select(regio =RegioNaam, code = RegioCode,party, votes) %>%
filter(!is.na(votes)) %>%
group_by(code) %>%
mutate(total = sum(votes)) %>%
slice_max(votes)
df_long$percentage <- (df_long$votes/df_long$total)*100
df_long$percentage <- round(df_long$percentage,1)
df_long$code <- gsub("G","",df_long$code)
#fix the names
df_long$party <- gsub("Partij.van.de.Arbeid..P.v.d.A..","PvdA",df_long$party)
df_long$party <- gsub("Democraten.66..D66.","D66",df_long$party)
df_long$party <- gsub("X50PLUS","Partij 50PLUS",df_long$party)
df_long$party <- gsub("Forum.voor.Democratie","FvD",df_long$party)
df_long$party <- gsub("Forum.voor.Democratie","FvD",df_long$party)
df_long$party <- gsub("SP..Socialistische.Partij.","SP",df_long$party)
df_long$party <- gsub("PVV..Partij.voor.de.Vrijheid.","PVV",df_long$party)
df_long$party <- gsub("Staatkundig.Gereformeerde.Partij..SGP.","SGP",df_long$party)
df_long$party <- gsub("Partij.voor.de.Dieren","PvdD",df_long$party)
df_long$party <- as.factor(df_long$party)
df_long$regio <- gsub("'","",df_long$regio)
df_long$regio <- gsub("-"," ",df_long$regio)
df_long <- left_join(df_long,colourscheme)
fptp_results <- table(df_long$party) %>% as.data.frame()
colnames(fptp_results) <- c("party","seats")
fptp_results <- left_join(fptp_results,colourscheme)
ggplot(fptp_results) +
ggpol::geom_parliament(aes(seats = seats, fill = party),color="black") +
#highlight the party in control of the House with a black line
scale_fill_manual(values = fptp_results$colour,
labels = fptp_results$party)+
coord_fixed()+
theme_void()
unique(shp_gemeentes$Gemeentena)
#link to spatial
shp_fptp <- left_join(shp_gemeentes, df_long, by = c("Gemeenteco"="code"))
shp_fptp <- shp_fptp %>%
filter(percentage >0.1)
#I need to make the shapefile alphabetical to match with the pie chart list
#This means removing apostrophe's at 's-Gravenhage and 's-Hertogenbosch
shp_fptp$Gemeentena <- gsub("'","",shp_gemeentes$Gemeentena)
#reorder
shp_fptp <- shp_fptp[order(shp_fptp$Gemeentena),]
unique(shp_fptp$Gemeentena)
#sort in long format
df_pie <- df_results %>%
pivot_longer(cols = VVD:Modern.Nederland, names_to = "party", values_to = "votes") %>%
select(regio =RegioNaam, code = RegioCode,party, votes) %>%
filter(!is.na(votes)) %>%
group_by(code) %>%
mutate(total = sum(votes))
df_pie$percentage <- (df_pie$votes/df_pie$total)*100
df_pie$percentage <- round(df_pie$percentage,1)
#
df_pie$party <- gsub("Partij.van.de.Arbeid..P.v.d.A..","PvdA",df_pie$party)
df_pie$party <- gsub("Democraten.66..D66.","D66",df_pie$party)
df_pie$party <- gsub("X50PLUS","Partij 50PLUS",df_pie$party)
df_pie$party <- gsub("Forum.voor.Democratie","FvD",df_pie$party)
df_pie$party <- gsub("Forum.voor.Democratie","FvD",df_pie$party)
df_pie$party <- gsub("SP..Socialistische.Partij.","SP",df_pie$party)
df_pie$party <- gsub("PVV..Partij.voor.de.Vrijheid.","PVV",df_pie$party)
df_pie$party <- gsub("Staatkundig.Gereformeerde.Partij..SGP.","SGP",df_pie$party)
df_pie$party <- gsub("Partij.voor.de.Dieren","PvdD",df_pie$party)
df_pie$party <- as.factor(df_pie$party)
df_pie$party <- as.character(df_pie$party)
df_pie$percentage <- as.numeric(df_pie$percentage)
unique(df_pie$regio)
check <- df_pie[!df_pie$regio %in% shp_fptp$Gemeentena]
check <- df_pie[!df_pie$regio %in% shp_fptp$Gemeentena,]
check
check <- df_long[!df_long$regio %in% shp_fptp$Gemeentena,]
check
names_df <- unique(df_long$regio)
names_shp <- unique(shp_fptp$Gemeentena)
names_shp
names_remove <- names_df[!names_df %in% names_shp,]
names_remove <- names_df[!names_df %in% names_shp]
names_remove
names_df <- unique(df_long$code)
names_shp <- unique(shp_fptp$Gemeenteco)
names_remove <- names_df[!names_df %in% names_shp]
names_remove
shp_fptp
check <- shp_fptp %>%
filter(Gemeenteco %in% names_remove)
check
check <- shp_gemeentes %>%
filter(Gemeenteco %in% names_remove)
check
names_remove
check <- df_long %>%
filter(code %in% names_remove)
check
check
df_long <- df_long %>%
filter(!code %in% names_remove)
df_long
df_long
length(unique(df_long$regio))
length(unique(shp_gemeentes$Gemeentena))
shp_fptp <- anti_join(shp_gemeentes, df_long, by = c("Gemeenteco"="code"))
shp_fptp
length(unique(df_long$code))
length(unique(shp_gemeentes$Gemeenteco))
check_code <- table(df_long$code) %>% as.data.frame()
check_code
check_code
check_code <- table(df_long$code) %>% as.data.frame() %>% filter(Freq>1)
check_code
check_code <- table(shp_gemeentes$Gemeenteco) %>% as.data.frame() %>% filter(Freq>1)
check_code
check_code
codes_to_remove <- df_long %>%
filter(code %in% names_remove)
codes_to_remove
library(dplyr)
library(tidyr)
library(sf)
library(ggplot2)
library(ggiraph)
library(widgetframe)
library(knitr)
library(plotly)
library(ggpol)
library(mapview)
library(leafpop)
library(leaflet)
df_results <- read.csv("Uitslag_alle_gemeenten_TK20210317.csv", sep=";")
shp_gemeentes <- st_read("Gemeentegrenzen_2021/Gemeentegrenzen_2021.shp")
shp_gemeentes$Gemeenteco <- gsub("GM","",shp_gemeentes$Gemeenteco)
colourscheme <- read.csv("partycolours.csv")
#sort in long format
df_long <- df_results %>%
pivot_longer(cols = VVD:Modern.Nederland, names_to = "party", values_to = "votes") %>%
select(regio =RegioNaam, code = RegioCode,party, votes) %>%
filter(!is.na(votes)) %>%
group_by(code) %>%
mutate(total = sum(votes)) %>%
slice_max(votes)
df_long$percentage <- (df_long$votes/df_long$total)*100
df_long$percentage <- round(df_long$percentage,1)
df_long$code <- gsub("G","",df_long$code)
#fix the names
df_long$party <- gsub("Partij.van.de.Arbeid..P.v.d.A..","PvdA",df_long$party)
df_long$party <- gsub("Democraten.66..D66.","D66",df_long$party)
df_long$party <- gsub("X50PLUS","Partij 50PLUS",df_long$party)
df_long$party <- gsub("Forum.voor.Democratie","FvD",df_long$party)
df_long$party <- gsub("Forum.voor.Democratie","FvD",df_long$party)
df_long$party <- gsub("SP..Socialistische.Partij.","SP",df_long$party)
df_long$party <- gsub("PVV..Partij.voor.de.Vrijheid.","PVV",df_long$party)
df_long$party <- gsub("Staatkundig.Gereformeerde.Partij..SGP.","SGP",df_long$party)
df_long$party <- gsub("Partij.voor.de.Dieren","PvdD",df_long$party)
df_long$party <- as.factor(df_long$party)
df_long$regio <- gsub("'","",df_long$regio)
df_long$regio <- gsub("-"," ",df_long$regio)
df_long <- left_join(df_long,colourscheme)
fptp_results <- table(df_long$party) %>% as.data.frame()
colnames(fptp_results) <- c("party","seats")
fptp_results <- left_join(fptp_results,colourscheme)
ggplot(fptp_results) +
ggpol::geom_parliament(aes(seats = seats, fill = party),color="black") +
#highlight the party in control of the House with a black line
scale_fill_manual(values = fptp_results$colour,
labels = fptp_results$party)+
coord_fixed()+
theme_void()
#sort in long format
df_pie <- df_results %>%
pivot_longer(cols = VVD:Modern.Nederland, names_to = "party", values_to = "votes") %>%
select(regio =RegioNaam, code = RegioCode,party, votes) %>%
filter(!is.na(votes)) %>%
group_by(code) %>%
mutate(total = sum(votes))
df_pie
df_pie$percentage <- (df_pie$votes/df_pie$total)*100
df_pie$percentage <- round(df_pie$percentage,1)
#
df_pie$party <- gsub("Partij.van.de.Arbeid..P.v.d.A..","PvdA",df_pie$party)
df_pie$party <- gsub("Democraten.66..D66.","D66",df_pie$party)
df_pie$party <- gsub("X50PLUS","Partij 50PLUS",df_pie$party)
df_pie$party <- gsub("Forum.voor.Democratie","FvD",df_pie$party)
df_pie$party <- gsub("Forum.voor.Democratie","FvD",df_pie$party)
df_pie$party <- gsub("SP..Socialistische.Partij.","SP",df_pie$party)
df_pie$party <- gsub("PVV..Partij.voor.de.Vrijheid.","PVV",df_pie$party)
df_pie$party <- gsub("Staatkundig.Gereformeerde.Partij..SGP.","SGP",df_pie$party)
df_pie$party <- gsub("Partij.voor.de.Dieren","PvdD",df_pie$party)
df_pie$party <- as.factor(df_pie$party)
df_pie$party <- as.character(df_pie$party)
df_pie$percentage <- as.numeric(df_pie$percentage)
df_pie
df_pie$code <- gsub("G","",df_pie$code)
names_df <- unique(df_pie$code)
names_shp <- unique(shp_gemeentes$Gemeenteco)
names_remove <- names_df[!names_df %in% names_shp]
names_remove
test <- df_pie %>%
filter(code %in% names_remove)
test
test
unique(test$regio)
unique(df_pie$regio)
#sort in long format
df_pie <- df_results %>%
pivot_longer(cols = VVD:Modern.Nederland, names_to = "party", values_to = "votes") %>%
select(regio =RegioNaam, code = RegioCode,party, votes) %>%
filter(!is.na(votes)) %>%
group_by(code) %>%
mutate(total = sum(votes))
df_pie$code <- gsub("G","",df_pie$code)
names_df <- unique(df_pie$code)
names_shp <- unique(shp_gemeentes$Gemeenteco)
names_remove <- names_df[!names_df %in% names_shp]
#remove Bonaire, Saba, Sint Eustasius
df_pie <- df_pie %>%
filter(!code %in% names_remove)
unique(df_pie$regio)
lenght(unique(df_pie$regio))
length(unique(df_pie$regio))
length(unique(shp_fptp$Gemeentena))
length(unique(shp_gemeentes$Gemeentena))
df_pie[!df_pie$regio %in% shp_fptp$Gemeentena,]
df_pie[df_pie$regio %in% shp_fptp$Gemeentena,]
unique(df_pie$code)
length(unique(df_pie$code))
length(unique(df_pie$regio))
checkit <- table(df_long$code) %>% as.data.frame()
checkit
checkit <- table(df_long$regio) %>% as.data.frame()
checkit
checkit <- table(shp_fptp$Gemeentena) %>% as.data.frame()
checkit
checkit <- table(shp_gemeentes$Gemeentena) %>% as.data.frame()
checkit
#sort in long format
df_pie <- df_results %>%
pivot_longer(cols = VVD:Modern.Nederland, names_to = "party", values_to = "votes") %>%
select(regio =RegioNaam, code = RegioCode,party, votes) %>%
filter(!is.na(votes)) %>%
group_by(code) %>%
mutate(total = sum(votes))
df_pie$code <- gsub("G","",df_pie$code)
names_df <- unique(df_pie$code)
names_shp <- unique(shp_gemeentes$Gemeenteco)
names_remove <- names_df[!names_df %in% names_shp]
#remove Bonaire, Saba, Sint Eustasius
df_pie <- df_pie %>%
filter(!code %in% names_remove)
df_pie$percentage <- (df_pie$votes/df_pie$total)*100
df_pie$percentage <- round(df_pie$percentage,1)
#
df_pie$party <- gsub("Partij.van.de.Arbeid..P.v.d.A..","PvdA",df_pie$party)
df_pie$party <- gsub("Democraten.66..D66.","D66",df_pie$party)
df_pie$party <- gsub("X50PLUS","Partij 50PLUS",df_pie$party)
df_pie$party <- gsub("Forum.voor.Democratie","FvD",df_pie$party)
df_pie$party <- gsub("Forum.voor.Democratie","FvD",df_pie$party)
df_pie$party <- gsub("SP..Socialistische.Partij.","SP",df_pie$party)
df_pie$party <- gsub("PVV..Partij.voor.de.Vrijheid.","PVV",df_pie$party)
df_pie$party <- gsub("Staatkundig.Gereformeerde.Partij..SGP.","SGP",df_pie$party)
df_pie$party <- gsub("Partij.voor.de.Dieren","PvdD",df_pie$party)
df_pie$party <- as.factor(df_pie$party)
df_pie$party <- as.character(df_pie$party)
df_pie$percentage <- as.numeric(df_pie$percentage)
pie_plot_list <- lapply(unique(df_pie$code), function(i) {
regio_df <- df_pie %>%
filter(code == i) %>%
dplyr::ungroup() %>%
select(party,percentage) %>%
filter(percentage >0.1) %>%
as.data.frame()
regio_df <- regio_df[order(regio_df$percentage,decreasing = T),]
regio_df <- left_join(regio_df,colourscheme)
ggplot(regio_df) +
geom_bar(aes(x = "", y = percentage, fill = party),
stat = "identity", colour = "black", width =1) +
#geom_text(aes(x = "", y = pct, label = percent(pct)), position = position_stack(vjust = 0.5))+
coord_polar("y", start = 0) +
labs(x = NULL, y = NULL, fill = NULL,
title = paste("Verkiezingsuitslag",i)) +
theme_classic()+
scale_fill_manual(values = regio_df$colour,
limits = regio_df$party)+
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5, color = "black"))
})
pie_plot_list[[1]]
pie_plot_list <- lapply(unique(df_pie$code), function(i) {
regio_df <- df_pie %>%
filter(code == i) %>%
dplyr::ungroup() %>%
select(party,percentage) %>%
filter(percentage >0.1) %>%
as.data.frame()
regio_df <- regio_df[order(regio_df$percentage,decreasing = T),]
regio_df <- left_join(regio_df,colourscheme)
ggplot(regio_df) +
geom_bar(aes(x = "", y = percentage, fill = party),
stat = "identity", colour = "black", width =1) +
#geom_text(aes(x = "", y = pct, label = percent(pct)), position = position_stack(vjust = 0.5))+
coord_polar("y", start = 0) +
labs(x = NULL, y = NULL, fill = NULL,
title = paste("Verkiezingsuitslag",regio_df$regio)) +
theme_classic()+
scale_fill_manual(values = regio_df$colour,
limits = regio_df$party)+
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5, color = "black"))
})
pie_plot_list[[1]]
i
i <- 1680
regio_df <- df_pie %>%
filter(code == i) %>%
dplyr::ungroup() %>%
select(party,percentage) %>%
filter(percentage >0.1) %>%
as.data.frame()
regio_df
regio_df
regio_df <- df_pie %>%
filter(code == i) %>%
dplyr::ungroup() %>%
select(party,percentage,regio) %>%
filter(percentage >0.1) %>%
as.data.frame()
regio_df
regio_df
regio_df$regio
pie_plot_list <- lapply(unique(df_pie$code), function(i) {
regio_df <- df_pie %>%
filter(code == i) %>%
dplyr::ungroup() %>%
select(party,percentage,regio) %>%
filter(percentage >0.1) %>%
as.data.frame()
regio_df <- regio_df[order(regio_df$percentage,decreasing = T),]
regio_df <- left_join(regio_df,colourscheme)
ggplot(regio_df) +
geom_bar(aes(x = "", y = percentage, fill = party),
stat = "identity", colour = "black", width =1) +
#geom_text(aes(x = "", y = pct, label = percent(pct)), position = position_stack(vjust = 0.5))+
coord_polar("y", start = 0) +
labs(x = NULL, y = NULL, fill = NULL,
title = paste("Verkiezingsuitslag",unique(regio_df$regio))) +
theme_classic()+
scale_fill_manual(values = regio_df$colour,
limits = regio_df$party)+
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5, color = "black"))
})
pie_plot_list[[1]]
i
regio_df <- df_pie %>%
filter(code == i) %>%
dplyr::ungroup() %>%
select(party,percentage,regio) %>%
filter(percentage >0.1) %>%
as.data.frame()
regio_df <- regio_df[order(regio_df$percentage,decreasing = T),]
regio_df <- left_join(regio_df,colourscheme)
ggplot(regio_df) +
geom_bar(aes(x = "", y = percentage, fill = party),
stat = "identity", colour = "black", width =1) +
#geom_text(aes(x = "", y = pct, label = percent(pct)), position = position_stack(vjust = 0.5))+
coord_polar("y", start = 0) +
labs(x = NULL, y = NULL, fill = NULL,
title = paste("Verkiezingsuitslag",unique(regio_df$regio))) +
theme_classic()+
scale_fill_manual(values = regio_df$colour,
limits = regio_df$party)+
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5, color = "black"))
plot.title = element_text(hjust = 0.5, color = "black"))
ggplot(regio_df) +
geom_bar(aes(x = "", y = percentage, fill = party),
stat = "identity", colour = "black", width =1) +
#geom_text(aes(x = "", y = pct, label = percent(pct)), position = position_stack(vjust = 0.5))+
coord_polar("y", start = 0) +
labs(x = NULL, y = NULL, fill = NULL,
title = paste("Verkiezingsuitslag",unique(regio_df$regio))) +
theme_classic()+
scale_fill_manual(values = regio_df$colour,
limits = regio_df$party)+
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5, color = "black"),
legend.position = "bottom")
mapview(shp_fptp,
zcol = "party",
col.regions = shp_fptp$colour,
popup = popupGraph(pie_plot_list, width = 300,height =300))
install.packages(c("httr","jsonlite"))
library(httr)
library(jsonlite)
res <- GET("https://opendata.arcgis.com/datasets/babfee00f5154e38b4f809a1910d6a8e_0.geojson")
res$content
data <- fromJSON(rawToChar(res$content))
names(data)
data$type
data$name
data$crs
data$features
res
library(geojsonsf)
install.packages("geojsonsf")
library(geojsonsf)
sf <- geojson_sf(res)
res$content
sf <- geojson_sf(res,expand_geometries = T)
sf <- geojson_sf("https://opendata.arcgis.com/datasets/babfee00f5154e38b4f809a1910d6a8e_0.geojson")
sf
