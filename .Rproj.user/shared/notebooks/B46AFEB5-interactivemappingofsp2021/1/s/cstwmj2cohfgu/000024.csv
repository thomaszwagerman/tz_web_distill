"0","#this might not be needed for the 2021 result, but for some reason "
"0","#there is an ONS code discrepancy between the results and our constituency shapefile."
"0","#So here I manually change some codes"
"0","constituency_shp$spc16cd[which(constituency_shp$spc16cd == ""S16000147"")] <- voteshare_df$`ONS Code`[which(voteshare_df$Constituency==""Glasgow Provan"")][1]"
"0","constituency_shp$spc16cd[which(constituency_shp$spc16cd == ""S16000148"")] <- voteshare_df$`ONS Code`[which(voteshare_df$Constituency==""Strathkelvin & Bearsden"")][1]"
"0","#reordering our order of codes to match the shapefile"
"0","voteshare_df <- voteshare_df[order(voteshare_df$`ONS Code`),]"
"0","#reset rownumbers so they line up"
"0","rownames(voteshare_df) <- 1:nrow(voteshare_df)"
"2","Setting row names on a tibble is deprecated."
"0","#hopefully I won't have to repeat that step for the 2021 data!"
"0",""
"0","#start of our list creation"
"0","bar_plot_list <- lapply(unique(voteshare_df$`ONS Code`), function(i) {"
"0","  #filter and group info per ONS code"
"0","  regio_df <- voteshare_df %>% "
"0","    filter(`ONS Code` == i) %>%"
"0","    dplyr::ungroup() %>% "
"0","    select(party,share,Constituency) %>%"
"0","    filter(share >0.1) %>% "
"0","    as.data.frame()"
"0","  #order by the vote share "
"0","  regio_df <- regio_df[order(regio_df$share,decreasing = T),]"
"0","  regio_df$share <- round(regio_df$share,1)"
"0","  "
"0","  #rejoin with the colourscheme"
"0","  regio_df <- left_join(regio_df,party_colours)"
"0","  "
"0","  #now making the bar chart!  "
"0","  ggplot(regio_df) +"
"0","    geom_bar(aes(x = party, y = share, fill = party),"
"0","             stat = ""identity"", "
"0","             colour = ""black"", width =1) +"
"0","    #adding the vote share as text"
"0","    geom_text(aes(x = party, y = share, label = paste0(share,""%"")), vjust = -0.5, size = 3.5)+"
"0","    #coord_polar(""y"", start = 0) +"
"0","    labs(x = NULL, y = NULL, fill = NULL, "
"0","         title = paste(unique(regio_df$Constituency))) +"
"0","    theme_classic()+"
"0","    #making sure it's ordered from biggest to smallest party"
"0","    scale_x_discrete(limits = regio_df$party)+"
"0","    #making sure the colours are automatically matched to the corresponding party"
"0","    scale_fill_manual(values = regio_df$colour_code, "
"0","                      limits = regio_df$party)+ "
"0","    #setting the theme"
"0","    theme(axis.line = element_blank(),"
"0","          axis.text = element_blank(),"
"0","          axis.ticks = element_blank(),"
"0","          plot.title = element_text(hjust = 0.5, color = ""black""),"
"0","          legend.position = ""bottom"")"
"0","})"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"2","Joining, by = ""party""
"
"0","#creating the edinburgh south example using the same method as above"
"0","edi_south <- voteshare_df %>% "
"0","  filter(`ONS Code` == ""S16000108"") %>%"
"0","  dplyr::ungroup() %>% "
"0","  select(party,share,Constituency) %>%"
"0","  filter(share >0.1) %>% "
"0","  as.data.frame()"
"0","edi_south <- left_join(edi_south,party_colours)"
"2","Joining, by = ""party""
"
"0","edi_south$share <- round(edi_south$share,1)"
"0",""
"0","#reorder so it displays from biggest to smallest"
"0","edi_south <- edi_south[order(edi_south$share,decreasing = T),]"
"0",""
"0","#plotting Edinburgh South to be displayed on the webpage as an example"
"0","ggplot(edi_south) +"
"0","  geom_bar(aes(x = party, y = share, fill = party),"
"0","           stat = ""identity"", "
"0","           colour = ""black"", width =1) +"
"0","  geom_text(aes(x = party, y = share, label = paste0(share,""%"")), vjust = -0.5, size = 3.5)+"
"0","  #coord_polar(""y"", start = 0) +"
"0","  labs(x = NULL, y = NULL, fill = NULL, "
"0","       title = paste(""Constituency result"",unique(edi_south$Constituency))) +"
"0","  theme_classic()+"
"0","  scale_x_discrete(limits = edi_south$party)+"
"0","  scale_fill_manual(values = edi_south$colour_code, "
"0","                    limits = edi_south$party)+ "
"0","  theme(axis.line = element_blank(),"
"0","        axis.text = element_blank(),"
"0","        axis.ticks = element_blank(),"
"0","        plot.title = element_text(hjust = 0.5, color = ""black""),"
"0","        legend.position = ""bottom"")"
"0",""
